{% extends "base.html" %}

{% block style %}
    <style>
        table {
            border-collapse: collapse;
            border-spacing: 0;
        }
        button {
            width: 100%;
            height: 100%;
            border-radius: 0;
            border-color: white;
            background: rgb(200, 200, 200);
        }
        button:active, button:focus {
            outline: 0;
        }
        button:disabled {
            color: #ccc;
            background: rgb(200, 200, 200);
        }
        ::-webkit-input-placeholder {
            text-align: center;
        }
        .field_td {
            width: 25px;
            height: 25px;
            padding: 0;
            border: 1px solid rgb(123, 123, 123);
            text-align: center;
            font-family: "Franklin Gothic Heavy", serif;
            font-weight: bold;
            background: rgb(170, 170, 170);
            cursor: default;
        }
        .menu_td {
            vertical-align: middle;
            padding: 0 0 0 1px;
            text-align: center;
            font-family: "Franklin Gothic", serif;
            font-size: 10px;
        }
        .bg_div {
            position: relative;
            left: 50%;
            top: 150px;
            background: silver;
        }
        .menu_div {
            width: 230px;
            height: 81px;
            position: absolute;
            left: 50%;
            top: 17px;
            padding-top: 2px;
            margin-left: -115px;
        }
        .field {
            position: absolute;
            left: 17px;
            top: 117px;
        }
        .field_input {
            width: 18px;
            padding: 0;
            font-size: 10px;
        }
        .field_input:active, .field_input:focus {
            outline: 0;
        }
        .new_game_button {
            width: 60px;
            height: 43px;
            position: absolute;
            left: 165px;
            top: 20px;
            border-radius: 0;
            border-color: white;
            font-family: "Franklin Gothic Heavy", serif;
            font-weight: bold;
            background: rgb(200, 200, 200);
            cursor: pointer;
        }
        .end_game_button {
            width: 100px;
            height: 43px;
            position: absolute;
            left: 50%;
            top: 20px;
            margin-left: -50px;
            border-radius: 0;
            border-color: white;
            font-size: 25px;
            background: rgb(200, 200, 200);
            cursor: pointer;
        }
        .bg_menu_top {
            height: 2px;
            position: absolute;
            left: 17px;
            top: 15px;
            background: rgb(123, 123, 123);
        }
        .bg_menu_top:after {
            content: '';
            box-sizing: border-box;
            position: absolute;
            left: 100%;
            border-width: 1px;
            border-style: solid;
            border-color: rgb(123, 123, 123) transparent transparent rgb(123, 123, 123);
        }
        .bg_menu_top:before {
            content: '';
            box-sizing: border-box;
            position: absolute;
            left: -2px;
            border-width: 1px;
            border-style: solid;
            border-color: rgb(123, 123, 123) rgb(123, 123, 123) transparent transparent;
        }
        .bg_menu_left {
            width: 2px;
            height: 83px;
            position: absolute;
            left:15px;
            top: 17px;
            background: rgb(123, 123, 123);
        }
        .bg_menu_left:after {
            content: '';
            box-sizing: border-box;
            position: absolute;
            top: -2px;
            border-width: 1px;
            border-style: solid;
            border-color: transparent transparent rgb(123, 123, 123) rgb(123, 123, 123);
        }
        .bg_menu_left:before {
            content: '';
            box-sizing: border-box;
            position: absolute;
            top: 100%;
            border-width: 1px;
            border-style: solid;
            border-color: rgb(123, 123, 123) transparent transparent rgb(123, 123, 123);
        }
        .bg_menu_bottom {
            height: 2px;
            position: absolute;
            left: 17px;
            top: 100px;
            background: white;
        }
        .bg_menu_bottom:after {
            content: '';
            box-sizing: border-box;
            position: absolute;
            left: -2px;
            border-width: 1px;
            border-style: solid;
            border-color: transparent white white transparent;
        }
        .bg_menu_bottom:before {
            content: '';
            box-sizing: border-box;
            position: absolute;
            left: 100%;
            border-width: 1px;
            border-style: solid;
            border-color: transparent transparent white white;
        }
        .bg_menu_right {
            width: 2px;
            height: 83px;
            position: absolute;
            top: 17px;
            background: white;
        }
        .bg_menu_right:after {
            content: '';
            box-sizing: border-box;
            position: absolute;
            top: -2px;
            border-width: 1px;
            border-style: solid;
            border-color: transparent white white transparent;
        }
        .bg_menu_right:before {
            content: '';
            box-sizing: border-box;
            position: absolute;
            top: 100%;
            border-width: 1px;
            border-style: solid;
            border-color: white white transparent transparent;
        }
        .bg_field_top {
            height: 2px;
            position: absolute;
            left: 17px;
            top: 115px;
            background: rgb(123, 123, 123);
        }
        .bg_field_top:after {
            content: '';
            box-sizing: border-box;
            position: absolute;
            left: 100%;
            border-width: 1px;
            border-style: solid;
            border-color: rgb(123, 123, 123) transparent transparent rgb(123, 123, 123);
        }
        .bg_field_top:before {
            content: '';
            box-sizing: border-box;
            position: absolute;
            left: -2px;
            border-width: 1px;
            border-style: solid;
            border-color: rgb(123, 123, 123) rgb(123, 123, 123) transparent transparent;
        }
        .bg_field_left {
            width: 2px;
            position: absolute;
            left: 15px;
            top: 117px;
            background: rgb(123, 123, 123);
        }
        .bg_field_left:after {
            content: '';
            box-sizing: border-box;
            position: absolute;
            top: -2px;
            border-width: 1px;
            border-style: solid;
            border-color: transparent transparent rgb(123, 123, 123) rgb(123, 123, 123);
        }
        .bg_field_left:before {
            content: '';
            box-sizing: border-box;
            position: absolute;
            top: 100%;
            border-width: 1px;
            border-style: solid;
            border-color: rgb(123, 123, 123) transparent transparent rgb(123, 123, 123);
        }
        .bg_field_bottom {
            height: 2px;
            position: absolute;
            left: 17px;
            background: white;
        }
        .bg_field_bottom:after {
            content: '';
            box-sizing: border-box;
            position: absolute;
            left: -2px;
            border-width: 1px;
            border-style: solid;
            border-color: transparent white white transparent;
        }
        .bg_field_bottom:before {
            content: '';
            box-sizing: border-box;
            position: absolute;
            left: 100%;
            border-width: 1px;
            border-style: solid;
            border-color: transparent transparent white white;
        }
        .bg_field_right {
            width: 2px;
            position: absolute;
            top: 117px;
            background: white;
        }
        .bg_field_right:after {
            content: '';
            box-sizing: border-box;
            position: absolute;
            top: -2px;
            border-width: 1px;
            border-style: solid;
            border-color: transparent white white transparent;
        }
        .bg_field_right:before {
            content: '';
            box-sizing: border-box;
            position: absolute;
            top: 100%;
            border-width: 1px;
            border-style: solid;
            border-color: white white transparent transparent;
        }
        .bg_out_top {
            height: 2px;
            position: absolute;
            left: 2px;
            background: white;
        }
        .bg_out_top:after {
            content: '';
            box-sizing: border-box;
            position: absolute;
            left: 100%;
            border-width: 1px;
            border-style: solid;
            border-color: white transparent transparent white;
        }
        .bg_out_top:before {
            content: '';
            box-sizing: border-box;
            position: absolute;
            left: -2px;
            border-width: 1px;
            border-style: solid;
            border-color: white white transparent transparent;
        }
        .bg_out_left {
            width: 2px;
            position: absolute;
            top: 2px;
            background: white;
        }
        .bg_out_left:after {
            content: '';
            box-sizing: border-box;
            position: absolute;
            top: -2px;
            border-width: 1px;
            border-style: solid;
            border-color: transparent transparent white white;
        }
        .bg_out_left:before {
            content: '';
            box-sizing: border-box;
            position: absolute;
            top: 100%;
            border-width: 1px;
            border-style: solid;
            border-color: white transparent transparent white;
        }
        .bg_out_bottom {
            height: 2px;
            position: absolute;
            left: 2px;
            background: rgb(123, 123, 123);
        }
        .bg_out_bottom:after {
            content: '';
            box-sizing: border-box;
            position: absolute;
            left: -2px;
            border-width: 1px;
            border-style: solid;
            border-color: transparent rgb(123, 123, 123) rgb(123, 123, 123) transparent;
        }
        .bg_out_bottom:before {
            content: '';
            box-sizing: border-box;
            position: absolute;
            left: 100%;
            border-width: 1px;
            border-style: solid;
            border-color: transparent transparent rgb(123, 123, 123) rgb(123, 123, 123);
        }
        .bg_out_right {
            width: 2px;
            position: absolute;
            top: 2px;
            background: rgb(123, 123, 123);
        }
        .bg_out_right:after {
            content: '';
            box-sizing: border-box;
            position: absolute;
            top: -2px;
            border-width: 1px;
            border-style: solid;
            border-color: transparent rgb(123, 123, 123) rgb(123, 123, 123) transparent;
        }
        .bg_out_right:before {
            content: '';
            box-sizing: border-box;
            position: absolute;
            top: 100%;
            border-width: 1px;
            border-style: solid;
            border-color: rgb(123, 123, 123) rgb(123, 123, 123) transparent transparent;
        }
    </style>
{% endblock %}

{% block body %}
    <div class="bg_div" id="bg_div">
        <div class="bg_out_top" id="bg_out_top"></div>
        <div class="bg_field_top" id="bg_field_top"></div>
        <div class="bg_menu_top" id="bg_menu_top"></div>
        <div class="bg_out_left" id="bg_out_left"></div>
        <div class="bg_field_left" id="bg_field_left"></div>
        <div class="bg_menu_left" id="bg_menu_left"></div>
        <div class="bg_out_bottom" id="bg_out_bottom"></div>
        <div class="bg_field_bottom" id="bg_field_bottom"></div>
        <div class="bg_menu_bottom" id="bg_menu_bottom"></div>
        <div class="bg_out_right" id="bg_out_right"></div>
        <div class="bg_field_right" id="bg_field_right"></div>
        <div class="bg_menu_right" id="bg_menu_right"></div>

        {% if game.game_status == 'Continue' or game.game_status == 'Started' %}
            <div class="menu_div">
                <form method="POST" action="{% url 'main_page' %}">
                    <table>
                        <tbody>
                            <tr>
                                <td class="menu_td"></td>
                                <td class="menu_td"></td>
                                <td class="menu_td" style="width: 30px;">Rows</td>
                                <td class="menu_td" style="width: 30px;">Cols</td>
                                <td class="menu_td" style="width: 30px;">Bombs</td>
                            </tr>
                            {% for field in form.difficulty %}
                                <tr>
                                    <td class="menu_td" style="font-size: 5px;">{{ field.tag }}</td>
                                    <td class="menu_td" style="text-align: left; font-weight: bold;">{{ field.choice_label }}</td>
                                    {% if field.choice_label == 'Beginner' %}
                                        <td class="menu_td">9</td>
                                        <td class="menu_td">9</td>
                                        <td class="menu_td">10</td>
                                    {% elif field.choice_label == 'Skilled' %}
                                        <td class="menu_td">16</td>
                                        <td class="menu_td">16</td>
                                        <td class="menu_td">40</td>
                                    {% elif field.choice_label == 'Expert' %}
                                        <td class="menu_td">16</td>
                                        <td class="menu_td">30</td>
                                        <td class="menu_td">99</td>
                                    {% elif field.choice_label == 'Custom' %}
                                        <td class="menu_td">{{ form.rows }}</td>
                                        <td class="menu_td">{{ form.columns }}</td>
                                        <td class="menu_td">{{ form.bombs }}</td>
                                    {% endif %}
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    <button class="new_game_button" name="new_game" value="1">New Game</button>
                </form>
            </div>
        {% else %}
            <div class="menu_div" id="menu_div">
                <form method="POST" action="{% url 'main_page' %}">
                    <button class="end_game_button" name="end_game" value="1">
                        {% if game.game_status == 'Win' %}
                            &#128578;
                        {% else %}
                            &#128577;
                        {% endif %}
                    </button>
                </form>
            </div>
        {% endif %}

        <div class="field" id="field">
            <form method="POST" action="{% url 'main_page' %}">
                <table>
                    <tbody>
                        {% for line in game.field.field %}
                            <tr>
                                {% for cell in line %}
                                    {% if cell.visible %}
                                        {% if cell.cell_info == '1' %}
                                            <td class="field_td" style="color: blue;">{{ cell.cell_info }}</td>
                                        {% elif cell.cell_info == '2' %}
                                            <td class="field_td" style="color: green;">{{ cell.cell_info }}</td>
                                        {% elif cell.cell_info == '3' %}
                                            <td class="field_td" style="color: red;">{{ cell.cell_info }}</td>
                                        {% elif cell.cell_info == '4' %}
                                            <td class="field_td" style="color: darkblue;">{{ cell.cell_info }}</td>
                                        {% elif cell.cell_info == '5' %}
                                            <td class="field_td" style="color: darkred;">{{ cell.cell_info }}</td>
                                        {% elif cell.cell_info == '0' %}
                                            <td class="field_td"> </td>
                                        {% elif cell.cell_info == 'b' %}
                                            {% if cell.last_cell %}
                                                <td class="field_td" style="font-size: 12px; background: darkred;">&#128163;</td>
                                            {% else %}
                                                <td class="field_td" style="font-size: 12px;">&#128163;</td>
                                            {% endif %}
                                        {% else %}
                                            <td class="field_td" style="color: slateblue;">{{ cell.cell_info }}</td>
                                        {% endif %}
                                    {% elif cell.flag %}
                                        <td class="field_td">
                                            {% if game.game_status == 'Win' or game.game_status == 'Lose' %}
                                                <button disabled>
                                                    <div style="width: 5px; margin-left: -3px; font-size: 12px;">&#128681;</div>
                                                </button>
                                            {% else %}
                                                <button id="{{ cell.coordinate }}" name="open_cell" value="{{ cell.x }},{{cell.y }}" oncontextmenu="SetFlag('{{ cell.coordinate }}'); return false">
                                                    <div style="width: 5px; margin-left: -3px; font-size: 12px;">&#128681;</div>
                                                </button>
                                            {% endif %}
                                        </td>
                                    {% elif game.game_status == 'Lose'%}
                                        <td class="field_td">
                                            <button disabled></button>
                                        </td>
                                    {% else %}
                                        <td class="field_td">
                                            <button id="{{ cell.coordinate }}" name="open_cell" value="{{ cell.x }},{{cell.y }}" oncontextmenu="SetFlag('{{ cell.coordinate }}'); return false">
                                            </button>
                                        </td>
                                    {% endif %}
                                {% endfor %}
                            </tr>
                        {%  endfor %}
                    </tbody>
                </table>
            </form>
            <script>
                function SetFlag(coordinate) {
                    const button = document.getElementById(coordinate);
                    button.name = "flag_cell";
                    button.click();
                }
            </script>
        </div>

        <script>
            const field = document.getElementById('field');
            const bg_div =  document.getElementById('bg_div');
            document.getElementById('bg_field_top').style.width = field.offsetWidth + "px";
            document.getElementById('bg_menu_top').style.width = field.offsetWidth + "px";
            document.getElementById('bg_out_top').style.width = field.offsetWidth + 30 + "px";
            document.getElementById('bg_out_bottom').style.width = field.offsetWidth + 30 + "px";
            document.getElementById('bg_field_bottom').style.width = field.offsetWidth + "px";
            document.getElementById('bg_menu_bottom').style.width = field.offsetWidth + "px";
            document.getElementById('bg_out_bottom').style.top = field.offsetHeight + 132 + "px";
            document.getElementById('bg_field_bottom').style.top = field.offsetHeight + 117 + "px";
            document.getElementById('bg_out_left').style.height = field.offsetHeight + 130 + "px";
            document.getElementById('bg_field_left').style.height = field.offsetHeight + "px";
            document.getElementById('bg_out_right').style.height = field.offsetHeight + 130 + "px";
            document.getElementById('bg_field_right').style.height = field.offsetHeight + "px";
            document.getElementById('bg_out_right').style.left = field.offsetWidth + 32 + "px";
            document.getElementById('bg_field_right').style.left = field.offsetWidth + 17 + "px";
            document.getElementById('bg_menu_right').style.left = field.offsetWidth + 17 + "px";
            bg_div.style.height = field.offsetHeight + 134 + "px";
            bg_div.style.width = field.offsetWidth + 34 + "px";
            bg_div.style.marginLeft = -bg_div.offsetWidth / 2 + "px";
        </script>
    </div>
{% endblock %}